#!/usr/bin/env node

const fs = require('fs');
const program = require('commander');
const debug = require('debug')('meta-yarn-clean');
const getMetaFile = require('get-meta-file');
const loop = require('loop');
const path = require('path');
const util = require('util');

if (process.argv[2] === '--help') {
  return console.log(`\n  usage:\n\n    meta yarn clean [--cwd some/rel/path]\n\n  options: \n\n    --cwd some/rel/path   delete the node_modules in a relative directory.\n`);
}

const meta = getMetaFile();
const projects = meta.projects;
const folders = Object.keys(projects).map((folder) => { return path.resolve(folder); });

folders.unshift(process.cwd());

const args = {
  command: 'rm -rf node_modules',
  directories: folders.reverse()
};

if (process.argv[2] === '--cwd' && process.argv[3]) {
  const cwd = process.argv[3];
  args.command = `rm -rf ${cwd}/node_modules`;
}

loop(args);